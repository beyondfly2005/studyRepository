# 微服务

SOA WebService

单体之间拆开 按业务功能或按模块

微服务



按功能划分，而非按业务划分 比如拆分日志

拆分 文件上传服务



微服务 细小粒度 一个商城一个服务

拆分为 订单 回话 商品管理 购物车 

也不是微服务 知识拆的更细了，也不是微服务



微服务 体现的时候 

不依赖

不依靠

独立

渣男 原则 - 不主动 不拒绝 不负责



订单与 回话 强依赖

restFul 跨平台 



不主动 ->  调不通 责任倒置，服务容错，

不拒绝 -> 跨平台，谁来都可以 任何语言都可以restful

不负责 -> 掉不掉通跟我没关系 即使订单模块 全部下线 也不影响 商品管理 



### 



### 亿级流量



Dubbo -> RPC   -> 对象（序列化）

DobbX  -> http  ->   对象（序列化）

WebService 跨平台 是由于xml

RPC 比 http效率高

RPC  RMI  JDK提供了RMI  dobbo替换了RMI 





###　服务拆分与治理

服务拆分

老项目改造

第一次拆分　

-　尼玛 拆多了
-　卧槽 好像没拆

AKF拆分原则

用量瓶颈： 

​			网络 IO  磁盘IO  带宽使用

​			计算密集 ：音视频 图形处理 多媒体 转码 转格式

业务维度

技术维度：文件服务 搜索服务 通知推送 日志服务

分久必合 合久必分

> 中台

介于前台和后台之间的 

前台 前端 接入层 IOS 安卓 

后台 业务逻辑 业务处理 CRUD -> 数据库

中台 前台拿一点 后台拿一点，

​		技术中台

​		业务中台

​		数据中台



自助建站系统： 模块 可选择：搜索 √  BBS√ 上传文件√  一键生成

多租户  前台多租户



中台项目  产品交互设计 需求收集 

​		前端 UI UE

​		后端



很多项目 很多类似模块 有积累  有钱  

抽取



拉勾网  中台

#### 服务治理

单体应用运维成本

java开发做了运维的活

熟悉shell脚本 熟悉linux操作系统 熟悉python 



运维开发 Devops

Git JENKINS 云计算 CI/CD  持续集成和持续交付

持续测试  python 

数据中台 

大数据 方向运维

持续集成 CI/CD Jenkense 容器编码 

云服务 opens  容器docker k8s

服务的动态上下线

动态扩容

持续集成->  今天晚上更版本/上线 回不去了 

统一提交 代码 统一测试，统一时间点 

集成运维，集成服务器 每天（每周 每两天 固定时间点）固定时间点 ，打包 -> 测试

执行测试，写代码的时候 也得写测试；



小的业务模块 ；随着业务的迭代，和版本更新， 不影响之前的 做好的版本  写测试用例 保证之前约定的接口 都能调通；没有新的业务逻辑 针对原来的接口 执行原来的测试用例 你自己都跑不通， 别人调你肯定也写不通

持续集成，本机测试好->提交到git  ->执行测试用例 代码质量检查 利用阿里规约->测试报告发你邮箱  上线就简单了 不用再

服务的部署



###  亿级流量网关设计

![image-20200520210613970](C:\Users\beyond\AppData\Roaming\Typora\typora-user-images\image-20200520210613970.png)



网关可以设计在整个系统的最外边

也可以设计在 内部



入口级别网关   流量网关 

业务网关  

识别功能 支持编程 拦截 防火墙 AWF  -> java Nginx Netty +C +Lua

流量网关 支持AWF 日志统计访客统计；特点：抽象公用



系统中有部分需要鉴权  有部分不需要鉴权

微服务鉴权：JWT  Token 带信息

分布式系统 Token 无状态 任何节点都可以做



业务网关 并不是指负责鉴权 

流量网关 尽可能抽象

业务网关 尽可能从业务中抽象  商城->商品详情页

负载均衡 定位和查找服务器



网关 redis尽量前置  

Tomcat会话上下文   处理连接的线程池 业务线程池

APR异步网络 NIO BIO



APR JNDI 加载DLL SO 加载操作系统本地的

业务线程线程池 包含 会话线程 session（ 可以禁用） 上下文 Request/Response

New 一堆对象 



netty 网关 

nginx 网关 C语言 lua语言写的网关  kong

​		网关 简单脚步就能够动态输出的功能

​		业务网关多做几个，集群，负责多种

前置 



lua -> lua git 

tengine.taobao.org  运维手段 日志健康 DNS缓存

多个css变成一个请求

openresty.org

jfinal SpringBoot



nginx 访问数据库

nginx访问redis

nginx



高并发 全方面 多维度：负载均衡 



1万以下 ：SSM熟练+底层原理 能干活 比较放心

2万以下：压力指数级上升 结婚生娃养老 springCloud技术栈 

​				面试造火箭 进去拧螺丝  ；面试极高难度 专业的研发标准 专业的

​				面试 多线程 主板级别 研究电路 硅元素 沙子 主板级别 

​				多线程JVM 马老师 黄老师 

​				JVM 多线程

3万以下	架构师 是下一步 ，技术主管 主程 参与技术架构  选型



​		管理 让人骗



​    
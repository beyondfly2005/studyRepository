

> https://www.bilibili.com/video/BV1dQ4y1A75e?p=5

### 谷粒学院





### 





#### 后端技术



#### 前端技术

- vue
- 

#### 其他技术

- 阿里云oss
- 阿里云视频点播服务
- 阿里云短信服务器
- 微信支付
- docker
- git



#### P6 MybatisPuls 介绍

###### 一、简介

官网地址：http://mp.baomidou.com

参考教程：http://mp.baomidou.com/guide/



###### 二、特性

- 无侵入
- 损耗小
- 强大CRUD操作
- 支持Lambda形式调用
- 支持多种数据库



#### P7 Mybatis-Plus入门案例

###### 1、创建数据，创建数据库表

```sql
DROP TABLE IF EXISTS user;
CREATE TABLE user
(
 id BIGINT(20) NOT NULL COMMENT '主键ID',
 name VARCHAR(30) NULL DEFAULT NULL COMMENT '姓名',
 age INT(11) NULL DEFAULT NULL COMMENT '年龄',
 email VARCHAR(50) NULL DEFAULT NULL COMMENT '邮箱',
 PRIMARY KEY (id) 
 )
```

```sql
INSERT INTO user (id, name, age, email) VALUES
(1, 'Jone', 18, 'test1@baomidou.com'), (2, 'Jack', 20, 'test2@baomidou.com'), (3, 'Tom', 28, 'test3@baomidou.com'), (4, 'Sandy', 21, 'test4@baomidou.com'), (5, 'Billie', 24, 'test5@baomidou.com');
```



###### 2、创建SpringBoot工程

​	springboot-2.2.1版本

###### 3、引入相关依赖

- 引入mybatis依赖

```xml
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.4.0</version>
</dependency>
```

- 引入MySql依赖

```xml
<!--mysql-->
<dependency>
	<groupId>mysql</groupId
	<artifactId>mysql-connector-java</artifactId>
</dependency>
```



- 引入lombok依赖

```xml
<!--lombok用来简化实体类-->
	<dependency>
	<groupId>org.projectlombok</groupId>
	<artifactId>lombok</artifactId>
</dependency
```



###### 4、安装lombok插件



###### 5、配置application.properies文件

mysql5配置

```properties
#mysql数据库连接
spring.datasource.driver-class-namespring.datasource.url=jdbc:mysql://spring.datasource.username=root
spring.datasource.password=123456
```

mysql8配置（springboot2.1以上）

```properties
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/mybatis_plus?
serverTimezone=GMT%2B8
spring.datasource.username=root
spring.datasource.password=123456
```

UserMapper 接口



@MapperScan



测试类 FindAll

```java
    @Test
    void fidAll() {
        List<User> users = userMapper.selectList(null);
        System.out.println(users);
    }
```



###### 6、配置日志输出

```
#mybatis日志 mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl

```

#### P9 MyBatis添加操作

```java
    @Test
    void addUser(){
        User user = new User();
        user.setName("zhangsan");
        user.setAge(20);
        user.setEmail("123@qq.com");
        userMapper.insert(user);
    }
```

**MP自动生成ID，不需要手工设置**



#### P10 Mybatis主键生成策略

##### MP主键生成策略

MP自动生成ID，19位值

参考资料：分布式系统唯一ID生成方案汇总：

https://www.cnblogs.com/haoxinyue/p/5208136.html

- **自动增长** AUTO INCRMENT
  - 缺点 分库分表时 使用自动增长不方便
- **UUID**
  - 每次生成唯一的随机值
  - ID排序不方便
- **Redis生成ID**
- **mp自在策略  snowflake雪花算法**
  - 41bit机器id
  - 10bit机器id（其中5bit机器id +5bit机器id
  - 12bit毫秒内的流水号
  - 1bit符号位 永远为0



##### 如何配置主键生成策略

在主键的属性上增加注解@TableId

```java
@TableId(type=AUTO)  自动增长
@TableId(type=IPUT)  自行设置输入
@TableId(type=NONE) 自行设置
@TableId(type=UUID)  随机数
@TableId(type=ID_WORKER)  19位值雪花算法  Long值
@TableId(type=ID_WORKER_STR) 19位雪花片算法 字符串类型
```



#### P11 MybatisPlus实现自动填充

###### MybatisPlus实现修改

```java
    @Test
    void updateUser(){
        User user = new User();
        user.setId(1310456551164649473L);
        user.setAge(100);
        userMapper.updateById(user);
    }
```

###### MybatisPlus实现自动填充

修改表结构，添加字段create_time，updateTime

```sql
alter table User add create_time datetime;
alter table User add update_time datetime;
```

实体类中添加字段 createTime updateTime

```
	private Date createTime;
    private Date updateTime;
```

实体类中在需要自动填充的属性上添加注解

```java
    @TableField(fill= FieldFill.INSERT)
    private Date createTime;

    @TableField(fill= FieldFill.INSERT_UPDATE)
    private Date updateTime;
```

创建类，实现接口MetaObjectHandler及接口方法

```java
@Component
public class MymetaObjectHandler implements MetaObjectHandler {

    @Override
    public void insertFill(MetaObject metaObject) {
        this.setFieldValByName("createTime", new Date(), metaObject);
        this.setFieldValByName("updateTime", new Date(), metaObject);
    }

    @Override
    public void updateFill(MetaObject metaObject) {
        this.setFieldValByName("updateTime", new Date(), metaObject);
    }
}
```



#### P12 MybatisPlus实现乐观锁(1)

###### 乐观锁 

针对某类特定问题  使用锁的方式来解决

主要解决：丢失更新问题

如果不考虑事务的隔离性，会产生的问题？

- 读的问题：脏读、不可重复读、幻读(虚读)
- 写的问题：丢失更新
- 并发事务 先提交后提交的问题  先提交的会被后提交的覆盖

解决方案：

- 悲观锁：串行操作，只能一个人操作，其他人只能等待当前事务完成。
- 乐观锁：增加version版本号，提交的时候 比较版本号，提交成功版本号+1

MP实现自动更新

- 表中增加字段version int

- 实体类中添加version字段，并添加@Version注解

- 配置乐观锁插件

  ```
  
  ```

  

#### P13 MybatisPlus实现乐观锁(2)

MP实现自动更新

- 表中增加字段version int

  ```sql
  alter table user add version int;
  ```

- 实体类中添加version字段，并添加@Version注解

  ```java
      @Version
      private Integer version;
  ```

- 配置乐观锁插件

  插件写到启动类中

  插件写到配置文件中（推荐）

  ```
      @Version
      private int version;
  ```

  

#### P14 MybatisPlus实现分页

MP简单查询

- 根据id查询

```
User user = userMapper.selectById(1310486739126603777L);
```

- 多个id的批量查询

```
List<User> users = userMapper.selectBatchIds(Arrays.asList(1L,2L,3L));
```

- 根据map多条件查询

```java
    @Test
    void testSelectByMap(){
        HashMap<String,Object> map= new HashMap<>();
        map.put("name","Jone");
        map.put("age",18);
        List<User> users = userMapper.selectByMap(map);
        System.out.println(users);
    }
```

- 分页查询

  PageHelper 之前用的

  1、配置分页插件

  ```
   @Bean
      public PaginationInterceptor paginationInterceptor() {
          return new PaginationInterceptor();
      }
  ```

  

  ```java
  //Spring boot方式
  @Configuration
  @MapperScan("com.baomidou.cloud.service.*.mapper*")
  public class MybatisPlusConfig {
  
      @Bean
      public PaginationInterceptor paginationInterceptor() {
          PaginationInterceptor paginationInterceptor = new PaginationInterceptor();
          // 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求  默认false
          // paginationInterceptor.setOverflow(false);
          // 设置最大单页限制数量，默认 500 条，-1 不受限制
          // paginationInterceptor.setLimit(500);
          // 开启 count 的 join 优化,只针对部分 left join
          paginationInterceptor.setCountSqlParser(new JsqlParserCountOptimize(true));
          return paginationInterceptor;
      }
  }
  ```

  2、编写分页代码

  ```java
      @Test
      void testPage(){
          Page<User> page =new Page<>(1,3);
          userMapper.selectPage(page, null);
          System.out.println(page.getCurrent()); //当前页
          System.out.println(page.getRecords());  //每页数据list集合
          System.out.println(page.getSize());     //每页显示记录数
          System.out.println(page.getTotal());    //总记录数
          System.out.println(page.hasNext());     //是否有下一页
          System.out.println(page.hasPrevious());     //是否有上一页
      }
  ```

  

#### P15 MybatisPlus 实现逻辑删除

##### 物理删除

```
userMapper.deleteById(1L);
```

##### 批量删除

```
userMapper.deleteBatchIds(Array.asList)
```

##### 条件删除

<<<<<<< HEAD
#### P15 MybatisPlus 实现逻辑删除
=======
```
userMapper.deleteByMap
```
1、表中添加字段
>>>>>>> ca2e7a14ef275a6b064dee3fe34a4213676b1a0d

```sql
alter table User add deleted  tinyint default 0;  // boolean 或者使用MP自动填充
```

2、实体类添加字段 并添加注解@TableLogic

<<<<<<< HEAD
#### P16 MybatisPlus性能分析插件
=======
```
@TableLogic
private Integer deleted;
```

3、配置文件可修改默认值

application.properties

```
mybatis-plus.global-config.db-config.logic-delete-value=1		#删除
mybatis-plus.global-config.db-config.logic-not-delete-value=1  	#没有删除
```

4、配置逻辑删除插件

```java
@Bean
public ISqlInjector sqlInjector(){
	return new LogicSqlInjector();
}
```

5、查询已被标记删除的数据

不使用MP提供的方法，自己在mapper中写方法



#### P16 MybatisPlus性能分析插件

性能分析拦截器，用于输出每条SQL语句及其执行时间

SQL性能执行分析，开发环境使用，超过指定时间，停止运行，有助于发现问题

1、配置插件

```java
    @Bean
    @Profile({"dev","test"})
    public PerformanceInterceptor performanceInterceptor(){
        PerformanceInterceptor performanceInterceptor = new PerformanceInterceptor();
        performanceInterceptor.setMaxTime(1000);    //ms 超过此值则sql不执行
        performanceInterceptor.setFormat(true);
        return performanceInterceptor;
    }
```

2、SpringBoot中设置dev环境

```
spring.profiles.active=dev
```
>>>>>>> ca2e7a14ef275a6b064dee3fe34a4213676b1a0d



#### P17 MybatisPlus 实现条件查询



#### P18 第二天内容介绍

- 前后端分离开发概念
- 讲师摸块（后端）
- 讲师后端crud操作

#### P19 前后端分离概念介绍

1、前后端分离





#### P21 项目环境搭建



##### 创建 application.properties配置文件

```properties
#服务端口
server.port=8001

#服务名
spring.application.name=service-edu

#环境设置 dev test prod
spring.profiles.active=dev

#mysql数据库连接
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/course_db?serverTimezone=GMT%2B8
spring.datasource.username=root
spring.datasource.password=123456

#mybatis日志
mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl
```





#### P22 项目环境搭建-代码生成器

项目路径

主键生成策略

包名称

代码生成器



```java
 @Test  public void testGenerator() {  

//全局配置

  GlobalConfig config = new GlobalConfig();

  config.setActiveRecord(true)   //是否支持AR模式      

   .setAuthor("weiyunhui") //作者

   .setOutputDir("D:\\workspace_my\\mp03\\src\\main\\java") //生成路径    

    .setFileOverride(true)//文件覆盖    

  .setServiceName("%sService")  //设置生成的service接口名 首字母是否为I    

  .setIdType(IdType.AUTO) //主键策略       ; 

 
  //数据源配置   DataSourceConfig dsConfig = new DataSourceConfig();  

dsConfig.setDbType(DbType.MYSQL)  

  .setUrl("jdbc:mysql://localhost:3306/javaEE_0228")  

 .setDriverName("com.mysql.jdbc.Driver")    

.setUsername("root")  

  .setPassword("1234");  

//策略配置  

StrategyConfig  stConfig = new StrategyConfig();

  stConfig.setCapitalMode(true)  // 全局大写命名  

  .setDbColumnUnderline(true)  //表名 字段名 是否使用下滑 线命名    

.setNaming(NamingStrategy.underline_to_camel) // 数据 库表映射到实体的命名策略

    .setInclude("tbl_employee")  //生成的表

    .setTablePrefix("tbl_"); // 表前缀  

//包名策略  

PackageConfig pkConfig = new PackageConfig();  

pkConfig.setParent("com.atguigu.mp")

    .setController("controller")  

  .setEntity("beans")  

  .setService("service");

  AutoGenerator ag  = new AutoGenerator().setGlobalConfig(config)    

     .setDataSource(dsConfig)        

 .setStrategy(stConfig)    

     .setPackageInfo(pkConfig);  

ag.execute();  }   
```

#### P23 讲师管理模块-讲师列表





#### P25 整合Swagger

```
@Configurateion
@EnableSwagger2
public class SwaggerConfig{

}
```



配置扫描是的Swagger配置文件被扫描到



#### P26 统一结果返回

1、创建模块common_utils

2、定义接口，定义数据返回状态码

3、定义返回数据格式



构造方法私有化 不能使用new 创建静态方法成功的方法 和 失败的方法

链式编程 R.setMsg().setXX().set();







#### P28 分页查询

创建Page<Entity>对象



#### P29条件查询分页



#### P33 统一异常处理-全局异常



```
@ContollerAdvice
@ExceptionHandler(Exception.class)
@ReponseBody

```



#### P34 特定异常/自定义处理

##### 特定异常

```
@ContollerAdvice
@ExceptionHandler(Exception.class)
@ReponseBody

```

##### 自定义异常

```

```



#### P36 统一日志管理

LogBack





#### P53 项目第4天

- axios 在vue发送ajax请求
- element-ui
- nodejs
- npm
- babel
- 模块化
- webpack

- 项目搭建

#### P54 前端技术-axios使用

```vue
<script src="vue.min.js"></script>
<script src="axios.min.js"></script>
<script>
new Vue({
	el: “#app”,
	data: {
	
	},
	created(){
	
	},
	methods:{
		
	}	
})
<script>
```



#### P55 前端技术-axios使用2





#### P56 前端技术-element-ui介绍





#### P57 前端技术-nodejs介绍

###### 1、nodejs是什么

（2）简单的解释Node.js是运行在服务端的JavaScript

​	不需要浏览器，直接用nodejs运行JavaScript代码

（2）模拟服务器效果，比如tomcat

###### 2、安装nodejs

​	检查是否安装成功

```
node -v
```

###### 3、使用nodejs运行javascript代码

#### P58 前端技术-nodejs问题说明

4、vscode中打开

​	项目文件 右键 在终端中打开

5、问题说明

vscode 中 使用命令node -v 报错

解决方法：

​	先确定cmd 中 输入node -v 是否显示正常

​	vscode 图标，右键属性-兼容性 以管理员身份运行



#### P59 npm包管理工具

1、什么是NPM

Node Package Manage node包管理工具



#### P60 babal转码器

1、babel是什么

babel是转码器，把es6代码转为es5语法



2、安装babel工具

```
# npm 镜像加速
npm install --registry=https://registry.npm.taobao.org

npm install --global babel-cli

# 检查是否安装成功
babel --version
```

3、创建es6文件 转码为es5

```
let input =[1,2,3]
input=input.map(item=>item+1)
console.log(input)
```

4、创建.babelrc文件

```
{
    "presets": ["es2015"],
    "plugins":[]
}
```

5、安装转码器

在项目中安装

```
npm install --save-dev babel-preset-es2015
```

6、转码

```
mkdir dist1
bable src/example.js --out-file dist1/comiled.js
#或者
babel src/example.js -o dist1/comiled.js

#整个目录转码
mkdir dist2
bable src --out-dir dist2
```










